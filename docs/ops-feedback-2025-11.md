# 运维反馈需求（2025-11-23）

## 背景

- 运维在联调中发现自动发现结果、状态 API 与状态库自愈存在缺口，导致前端与集成方无法看到真实状态或直接 502。

## 需求清单

1. 自动发现结果落库与对外暴露
   - 自动发现的 Podman auto-update 单元（当前期望 53 个）需要落到持久层，并被 `/api/manual/services` 与相关存储返回，而不仅是环境变量中的手工两项。
   - 发现任务应在 DB 初始化完成后执行，异常要记录日志/事件避免静默短路。
2. 状态 API 硬化与可观测性
   - `/api/webhooks/status`、`/api/image-locks` 目前直接 502 且无日志，需要启动自检或路径内的显式错误响应，至少暴露“DB 不存在/不可写”“Podman 连接失败”等原因。
   - 返回体应包含可操作的错误字段，后台日志也要同步记录失败原因。
3. 状态库自愈与健康指引
   - 启动时若状态库缺失/不可写，应自动迁移或创建；无法自愈时在健康页给出修复指引（包含路径、需要设置的 env）。
4. 前端 Settings 展示
   - 在 Settings 页展示“发现的 auto-update 单元数量 + 列表摘要”，并与环境变量提供的手工单元区分显示，便于运维对账。
