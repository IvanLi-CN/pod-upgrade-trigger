# Example environment file for the pod-upgrade-trigger HTTP user service.
# Copy to ~/.config/pod-upgrade-trigger-http.env and adjust paths/secrets.
#
# 基线：直接复用现网容器的 env（示例：/srv/pod-upgrade-trigger/pod-upgrade-trigger.env）
# 仅在必要字段上做差异：二进制路径、可见地址、自更新配置。

# --- Core paths & network (align with current production) ---

# Durable state directory used in production. Inside the container this is
# /srv/app/data, bind-mounted from the host (e.g. /srv/pod-upgrade-trigger/data).
PODUP_STATE_DIR=/srv/app/data

# Explicit SQLite URL matching the state dir; optional because the binary
# defaults to ${PODUP_STATE_DIR}/pod-upgrade-trigger.db.
PODUP_DB_URL=sqlite:///srv/app/data/pod-upgrade-trigger.db

# HTTP listen address. Keep 0.0.0.0 so webhook-proxy (in container) can reach
# host via host.containers.internal:25111. Omitting this uses the same default.
PODUP_HTTP_ADDR=0.0.0.0:25111

# Public base URL exposed to callers.
# 示例域名，生产请替换为实际对外访问域名
PODUP_PUBLIC_BASE_URL=https://update.example.com

# Path to per-user containers/systemd units (used by manual operations).
PODUP_CONTAINER_DIR=/home/<user>/.config/containers/systemd

# Optional SSH host mode: when set, all host commands and host file access
# are executed on the SSH target via OpenSSH CLI (`ssh`).
# PODUP_SSH_TARGET=podup-test
#
# In SSH mode:
# - PODUP_CONTAINER_DIR is interpreted on the SSH target and is required for unit discovery.
# - PODUP_AUTO_UPDATE_LOG_DIR is interpreted on the SSH target; missing/unreadable is treated
#   as "no logs" and the service will not create the directory.

# --- Secrets & tokens ---

# Shared secret for the GitHub webhook signature.
PODUP_GH_WEBHOOK_SECRET=change-me

# Legacy token (no longer used for admin auth; kept for compatibility/UI status).
PODUP_TOKEN=change-me-too

# Units managed by manual trigger APIs.
PODUP_MANUAL_UNITS=blog-blog.service
PODUP_MANUAL_AUTO_UPDATE_UNIT=podman-auto-update.service

# --- Self-update (host binary) ---

# Command used by the built-in scheduler to trigger self-update runs.
# Typically points to scripts/self-update-runner.sh in the deployed tree.
# Example for this host:
# PODUP_SELF_UPDATE_COMMAND=/srv/pod-upgrade-trigger/self-update-runner.sh

# Cron-like schedule understood by the built-in scheduler:
# - "*/60 * * * *" = every 60 minutes
# - "0 */6 * * *"  = every 6 hours at minute 0
#PODUP_SELF_UPDATE_CRON="0 */6 * * *"

# When set to 1/true/yes/on, the scheduler will run self-update in dry-run mode.
#PODUP_SELF_UPDATE_DRY_RUN=1
